# Agilent-4UHV-Device.db

# Record definition file for one Agilent 4UHV Ion Pump Controller device. This is based on the work
# of Pete Owens from the Science and Technology Facilities Council (STFC).

# Parameters are:
#
# PORT - Name of the serial port configured in asynDriver.
#
# PREFIX - Prefix name for all PVs associated with the device.
#
# SERIAL_ADDRESS - Controller RS-485 serial address (from 0 to 31). For configuring this parameter,
# add 128 to the desired address. As an example, for the serial address 20, this parameter should be
# configured as 128 + 20 = 148.

##########################################################################
##                             One time readings                        ##
##########################################################################
# Model
record(stringin, "$(PREFIX):Model-Cte") {
    field(DESC, "Device model")
    field(DTYP, "stream")
    field(INP, "@Agilent-4UHV.proto getModel($(SERIAL_ADDRESS)) $(PORT)")

    field(PINI, "YES")
}

# Serial number
record(stringin, "$(PREFIX):SerialNumber-Cte") {
    field(DESC, "Device serial number")
    field(DTYP, "stream")
    field(INP, "@Agilent-4UHV.proto getSerialNumber($(SERIAL_ADDRESS)) $(PORT)")

    field(PINI, "YES")
}
##########################################################################
#                              CHAIN READINGS                            #
##########################################################################
record(longin, "$(PREFIX):FanTemperature-Mon") {
    field(DESC, "Fan temperature")
    field(DTYP, "stream")
    field(EGU, "Â°C")
    field(HOPR, "200")
    field(LOPR, "0")

    field(INP, "@Agilent-4UHV.proto getFanTemperature($(SERIAL_ADDRESS)) $(PORT)") 
}
# Protect
record(longin, "$(PREFIX):Protect-Mon") {
    field(DESC, "Protect")
    field(DTYP, "stream")
    field(INP, "@Agilent-4UHV.proto getProtect($(SERIAL_ADDRESS)) $(PORT)")
}
# Step mode
record(longin, "$(PREFIX):Step-Mon") {
    field(DESC, "Step mode")
    field(DTYP, "stream")
    field(INP, "@Agilent-4UHV.proto getStep($(SERIAL_ADDRESS)) $(PORT)")
} 
 
##########################################################################
##                             Set/Get Readings                         ##
##########################################################################
# Unit readback
record(mbbi, "$(PREFIX):Unit-RB") {
    field(DESC, "Unit readback")
    field(DTYP, "stream")
    field(INP, "@Agilent-4UHV.proto getUnit($(SERIAL_ADDRESS)) $(PORT)")

    field(ZRST, "Torr")
    field(ONST, "mbar")
    field(TWST, "Pa")
}
# Unit setpoint
record(mbbo, "$(PREFIX):Unit-SP") {
    field(DESC, "Unit setpoint")
    field(DTYP, "stream")
    field(OUT, "@Agilent-4UHV.proto setUnit($(SERIAL_ADDRESS)) $(PORT)")
    
    field(ZRST, "Torr")
    field(ONST, "mbar")
    field(TWST, "Pa")

    field(FLNK,"$(PREFIX):Unit-RB")
}

# Operating mode (autostart on/off) readback
record(bi, "$(PREFIX):Mode-RB") {
    field(DESC, "Autostart readback")
    field(DTYP, "stream")
    field(INP, "@Agilent-4UHV.proto getMode($(SERIAL_ADDRESS)) $(PORT)")
    field(ONAM, "On")
    field(ZNAM, "Off") 

}
# Operating mode (autostart on/off) setpoint
record(bo, "$(PREFIX):Mode-SP") {
    field(DESC, "Autostart setpoint")
    field(DTYP, "stream")
    field(ONAM, "On")
    field(OUT,  "@Agilent-4UHV.proto setMode($(SERIAL_ADDRESS)) $(PORT)")
    field(ZNAM, "Off")

    field(FLNK, "$(PREFIX):Mode-RB")
}

############################################################################
#                                  CHAIN                                   #
#               PREFIX-CH1  PREFIX-CH2  PREFIX-CH3  PREFIX-CH4             #
############################################################################
record(ai, "$(PREFIX):Trigger"){
	field(FLNK, "$(PREFIX):FanTemperature-Mon") 
} 
record(longin, "$(PREFIX):FanTemperature-Mon") {
    field(FLNK, "$(PREFIX):Protect-Mon")
}
record(longin, "$(PREFIX):Protect-Mon") {
    field(FLNK, "$(PREFIX):Step-Mon")
}
record(longin, "$(PREFIX):Step-Mon") {
    field(FLNK, "$(PREFIX):Unit-RB")
}
record(mbbi, "$(PREFIX):Unit-RB") {
    field(FLNK, "$(PREFIX):Mode-RB")
}
record(bi, "$(PREFIX):Mode-RB") {
    field(FLNK, "$(PREFIX-CH1):Current-Mon")
}
record(ai, "$(PREFIX-CH1):Current-Mon") {
    field(FLNK, "$(PREFIX-CH1):Pressure-Mon")
}
record(ai, "$(PREFIX-CH1):Pressure-Mon") {
    field(FLNK, "$(PREFIX-CH1):Voltage-Mon")
}
record(ai, "$(PREFIX-CH1):Voltage-Mon") {
    field(FLNK, "$(PREFIX-CH1):HVTemperature-Mon")
}
record(longin, "$(PREFIX-CH1):HVTemperature-Mon") {
    field(FLNK, "$(PREFIX-CH1):ErrorCode-Mon")
}
record(mbbi, "$(PREFIX-CH1):ErrorCode-Mon") {
    field(FLNK, "$(PREFIX-CH1):HVState-RB")
}
record(mbbi, "$(PREFIX-CH1):HVState-RB") {
    field(FLNK, "$(PREFIX-CH1):PowerMax-RB")
}
record(ai, "$(PREFIX-CH1):PowerMax-RB") {
    field(FLNK, "$(PREFIX-CH1):CurrentProtect-RB")
}
record(ai, "$(PREFIX-CH1):CurrentProtect-RB") {
    field(FLNK, "$(PREFIX-CH1):VoltageTarget-RB")
}
record(ai, "$(PREFIX-CH1):VoltageTarget-RB") {
    field(FLNK, "$(PREFIX-CH1):Setpoint-RB")
}
record(ai, "$(PREFIX-CH1):Setpoint-RB") {
    field(FLNK, "$(PREFIX-CH2):Current-Mon")
}
record(ai, "$(PREFIX-CH2):Current-Mon") {
    field(FLNK, "$(PREFIX-CH2):Pressure-Mon")
}
record(ai, "$(PREFIX-CH2):Pressure-Mon") {
    field(FLNK, "$(PREFIX-CH2):Voltage-Mon")
}
record(ai, "$(PREFIX-CH2):Voltage-Mon") {
    field(FLNK, "$(PREFIX-CH2):HVTemperature-Mon")
}
record(longin, "$(PREFIX-CH2):HVTemperature-Mon") {
    field(FLNK, "$(PREFIX-CH2):ErrorCode-Mon")
}
record(mbbi, "$(PREFIX-CH2):ErrorCode-Mon") {
    field(FLNK, "$(PREFIX-CH2):HVState-RB")
}
record(mbbi, "$(PREFIX-CH2):HVState-RB") {
    field(FLNK, "$(PREFIX-CH2):PowerMax-RB")
}
record(ai, "$(PREFIX-CH2):PowerMax-RB") {
    field(FLNK, "$(PREFIX-CH2):CurrentProtect-RB")
}
record(ai, "$(PREFIX-CH2):CurrentProtect-RB") {
    field(FLNK, "$(PREFIX-CH2):VoltageTarget-RB")
}
record(ai, "$(PREFIX-CH2):VoltageTarget-RB") {
    field(FLNK, "$(PREFIX-CH2):Setpoint-RB")
}
record(ai, "$(PREFIX-CH2):Setpoint-RB") {
    field(FLNK, "$(PREFIX-CH3):Current-Mon")
}
record(ai, "$(PREFIX-CH3):Current-Mon") {
    field(FLNK, "$(PREFIX-CH3):Pressure-Mon")
}
record(ai, "$(PREFIX-CH3):Pressure-Mon") {
    field(FLNK, "$(PREFIX-CH3):Voltage-Mon")
}
record(ai, "$(PREFIX-CH3):Voltage-Mon") {
    field(FLNK, "$(PREFIX-CH3):HVTemperature-Mon")
}
record(longin, "$(PREFIX-CH3):HVTemperature-Mon") {
    field(FLNK, "$(PREFIX-CH3):ErrorCode-Mon")
}
record(mbbi, "$(PREFIX-CH3):ErrorCode-Mon") {
    field(FLNK, "$(PREFIX-CH3):HVState-RB")
}
record(mbbi, "$(PREFIX-CH3):HVState-RB") {
    field(FLNK, "$(PREFIX-CH3):PowerMax-RB")
}
record(ai, "$(PREFIX-CH3):PowerMax-RB") {
    field(FLNK, "$(PREFIX-CH3):CurrentProtect-RB")
}
record(ai, "$(PREFIX-CH3):CurrentProtect-RB") {
    field(FLNK, "$(PREFIX-CH3):VoltageTarget-RB")
}
record(ai, "$(PREFIX-CH3):VoltageTarget-RB") {
    field(FLNK, "$(PREFIX-CH3):Setpoint-RB")
}
record(ai, "$(PREFIX-CH3):Setpoint-RB") {
    field(FLNK, "$(PREFIX-CH4):Current-Mon")
}
record(ai, "$(PREFIX-CH4):Current-Mon") {
    field(FLNK, "$(PREFIX-CH4):Pressure-Mon") 
}
record(ai, "$(PREFIX-CH4):Pressure-Mon") {
    field(FLNK, "$(PREFIX-CH4):Voltage-Mon") 
}
record(ai, "$(PREFIX-CH4):Voltage-Mon") {
    field(FLNK, "$(PREFIX-CH4):HVTemperature-Mon")
}
record(longin, "$(PREFIX-CH4):HVTemperature-Mon") {
    field(FLNK, "$(PREFIX-CH4):ErrorCode-Mon")
}
record(mbbi, "$(PREFIX-CH4):ErrorCode-Mon") {
    field(FLNK, "$(PREFIX-CH4):HVState-RB")
}
record(mbbi, "$(PREFIX-CH4):HVState-RB") {
    field(FLNK, "$(PREFIX-CH4):PowerMax-RB") 
}
record(ai, "$(PREFIX-CH4):PowerMax-RB") {
    field(FLNK,"$(PREFIX-CH4):CurrentProtect-RB")
}
record(ai, "$(PREFIX-CH4):CurrentProtect-RB") {
    field(FLNK, "$(PREFIX-CH4):VoltageTarget-RB")
}
record(ai, "$(PREFIX-CH4):VoltageTarget-RB") {
    field(FLNK, "$(PREFIX-CH4):Setpoint-RB")
}
record(ai, "$(PREFIX-CH4):Setpoint-RB") {
    field(FLNK, "$(PREFIX):Out")
} 